"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AttentionTokenHandler = exports.RequestTokenHandler = exports.Login7TokenHandler = exports.InitialSqlTokenHandler = exports.TokenHandler = exports.UnexpectedTokenError = void 0;

var _errors = require("../errors");

class UnexpectedTokenError extends Error {
  constructor(handler, token) {
    super('Unexpected token `' + token.name + '` in `' + handler.constructor.name + '`');
  }

}

exports.UnexpectedTokenError = UnexpectedTokenError;

class TokenHandler {
  onInfoMessage(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onErrorMessage(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onSSPI(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onDatabaseChange(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onLanguageChange(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onCharsetChange(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onSqlCollationChange(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onRoutingChange(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onPacketSizeChange(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onResetConnection(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onBeginTransaction(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onCommitTransaction(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onRollbackTransaction(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onFedAuthInfo(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onFeatureExtAck(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onLoginAck(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onColMetadata(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onOrder(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onRow(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onReturnStatus(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onReturnValue(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onDoneProc(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onDoneInProc(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onDone(token) {
    throw new UnexpectedTokenError(this, token);
  }

  onDatabaseMirroringPartner(token) {
    throw new UnexpectedTokenError(this, token);
  }

}
/**
 * A handler for tokens received in the response message to the initial SQL Batch request
 * that sets up different connection settings.
 */


exports.TokenHandler = TokenHandler;

class InitialSqlTokenHandler extends TokenHandler {
  constructor(connection) {
    super();
    this.connection = void 0;
    this.connection = connection;
  }

  onInfoMessage(token) {
    this.connection.emit('infoMessage', token);
  }

  onErrorMessage(token) {
    this.connection.emit('errorMessage', token);
  }

  onDatabaseChange(token) {
    this.connection.emit('databaseChange', token.newValue);
  }

  onLanguageChange(token) {
    this.connection.emit('languageChange', token.newValue);
  }

  onCharsetChange(token) {
    this.connection.emit('charsetChange', token.newValue);
  }

  onSqlCollationChange(token) {
    this.connection.databaseCollation = token.newValue;
  }

  onPacketSizeChange(token) {
    this.connection.messageIo.packetSize(token.newValue);
  }

  onBeginTransaction(token) {
    this.connection.transactionDescriptors.push(token.newValue);
    this.connection.inTransaction = true;
  }

  onCommitTransaction(token) {
    this.connection.transactionDescriptors.length = 1;
    this.connection.inTransaction = false;
  }

  onRollbackTransaction(token) {
    this.connection.transactionDescriptors.length = 1; // An outermost transaction was rolled back. Reset the transaction counter

    this.connection.inTransaction = false;
    this.connection.emit('rollbackTransaction');
  }

  onColMetadata(token) {
    this.connection.emit('error', new Error("Received 'columnMetadata' when no sqlRequest is in progress"));
    this.connection.close();
  }

  onOrder(token) {
    this.connection.emit('error', new Error("Received 'order' when no sqlRequest is in progress"));
    this.connection.close();
  }

  onRow(token) {
    this.connection.emit('error', new Error("Received 'row' when no sqlRequest is in progress"));
    this.connection.close();
  }

  onReturnStatus(token) {// Do nothing
  }

  onReturnValue(token) {// Do nothing
  }

  onDoneProc(token) {// Do nothing
  }

  onDoneInProc(token) {// Do nothing
  }

  onDone(token) {// Do nothing
  }

  onResetConnection(token) {
    this.connection.emit('resetConnection');
  }

}
/**
 * A handler for tokens received in the response message to a Login7 message.
 */


exports.InitialSqlTokenHandler = InitialSqlTokenHandler;

class Login7TokenHandler extends TokenHandler {
  constructor(connection) {
    super();
    this.connection = void 0;
    this.fedAuthInfoToken = void 0;
    this.routingData = void 0;
    this.loginAckReceived = false;
    this.connection = connection;
  }

  onInfoMessage(token) {
    this.connection.emit('infoMessage', token);
  }

  onErrorMessage(token) {
    this.connection.emit('errorMessage', token);
    const error = (0, _errors.ConnectionError)(token.message, 'ELOGIN');
    const isLoginErrorTransient = this.connection.transientErrorLookup.isTransientError(token.number);

    if (isLoginErrorTransient && this.connection.curTransientRetryCount !== this.connection.config.options.maxRetriesOnTransientErrors) {
      error.isTransient = true;
    }

    this.connection.loginError = error;
  }

  onSSPI(token) {
    if (token.ntlmpacket) {
      this.connection.ntlmpacket = token.ntlmpacket;
      this.connection.ntlmpacketBuffer = token.ntlmpacketBuffer;
    }

    this.connection.emit('sspichallenge', token);
  }

  onDatabaseChange(token) {
    this.connection.emit('databaseChange', token.newValue);
  }

  onLanguageChange(token) {
    this.connection.emit('languageChange', token.newValue);
  }

  onCharsetChange(token) {
    this.connection.emit('charsetChange', token.newValue);
  }

  onSqlCollationChange(token) {
    this.connection.databaseCollation = token.newValue;
  }

  onFedAuthInfo(token) {
    this.fedAuthInfoToken = token;
  }

  onFeatureExtAck(token) {
    const {
      authentication
    } = this.connection.config;

    if (authentication.type === 'azure-active-directory-password' || authentication.type === 'azure-active-directory-access-token' || authentication.type === 'azure-active-directory-msi-vm' || authentication.type === 'azure-active-directory-msi-app-service' || authentication.type === 'azure-active-directory-service-principal-secret') {
      if (token.fedAuth === undefined) {
        this.connection.loginError = (0, _errors.ConnectionError)('Did not receive Active Directory authentication acknowledgement');
      } else if (token.fedAuth.length !== 0) {
        this.connection.loginError = (0, _errors.ConnectionError)(`Active Directory authentication acknowledgment for ${authentication.type} authentication method includes extra data`);
      }
    } else if (token.fedAuth === undefined && token.utf8Support === undefined) {
      this.connection.loginError = (0, _errors.ConnectionError)('Received acknowledgement for unknown feature');
    } else if (token.fedAuth) {
      this.connection.loginError = (0, _errors.ConnectionError)('Did not request Active Directory authentication, but received the acknowledgment');
    }
  }

  onLoginAck(token) {
    if (!token.tdsVersion) {
      // unsupported TDS version
      this.connection.loginError = (0, _errors.ConnectionError)('Server responded with unknown TDS version.', 'ETDS');
      return;
    }

    if (!token.interface) {
      // unsupported interface
      this.connection.loginError = (0, _errors.ConnectionError)('Server responded with unsupported interface.', 'EINTERFACENOTSUPP');
      return;
    } // use negotiated version


    this.connection.config.options.tdsVersion = token.tdsVersion;
    this.loginAckReceived = true;
  }

  onRoutingChange(token) {
    // Removes instance name attached to the redirect url. E.g., redirect.db.net\instance1 --> redirect.db.net
    const [server] = token.newValue.server.split('\\');
    this.routingData = {
      server,
      port: token.newValue.port
    };
  }

  onDoneInProc(token) {// Do nothing
  }

  onDone(token) {// Do nothing
  }

  onPacketSizeChange(token) {
    this.connection.messageIo.packetSize(token.newValue);
  }

  onDatabaseMirroringPartner(token) {// Do nothing
  }

}
/**
 * A handler for tokens received in the response message to a RPC Request,
 * a SQL Batch Request, a Bulk Load BCP Request or a Transaction Manager Request.
 */


exports.Login7TokenHandler = Login7TokenHandler;

class RequestTokenHandler extends TokenHandler {
  constructor(connection, request) {
    super();
    this.connection = void 0;
    this.request = void 0;
    this.connection = connection;
    this.request = request;
  }

  onInfoMessage(token) {
    this.connection.emit('infoMessage', token);
  }

  onErrorMessage(token) {
    this.connection.emit('errorMessage', token);

    if (!this.request.canceled) {
      const error = new _errors.RequestError(token.message, 'EREQUEST');
      error.number = token.number;
      error.state = token.state;
      error.class = token.class;
      error.serverName = token.serverName;
      error.procName = token.procName;
      error.lineNumber = token.lineNumber;
      this.request.error = error;
    }
  }

  onDatabaseChange(token) {
    this.connection.emit('databaseChange', token.newValue);
  }

  onLanguageChange(token) {
    this.connection.emit('languageChange', token.newValue);
  }

  onCharsetChange(token) {
    this.connection.emit('charsetChange', token.newValue);
  }

  onSqlCollationChange(token) {
    this.connection.databaseCollation = token.newValue;
  }

  onPacketSizeChange(token) {
    this.connection.messageIo.packetSize(token.newValue);
  }

  onBeginTransaction(token) {
    this.connection.transactionDescriptors.push(token.newValue);
    this.connection.inTransaction = true;
  }

  onCommitTransaction(token) {
    this.connection.transactionDescriptors.length = 1;
    this.connection.inTransaction = false;
  }

  onRollbackTransaction(token) {
    this.connection.transactionDescriptors.length = 1; // An outermost transaction was rolled back. Reset the transaction counter

    this.connection.inTransaction = false;
    this.connection.emit('rollbackTransaction');
  }

  onColMetadata(token) {
    if (!this.request.canceled) {
      if (this.connection.config.options.useColumnNames) {
        const columns = Object.create(null);

        for (let j = 0, len = token.columns.length; j < len; j++) {
          const col = token.columns[j];

          if (columns[col.colName] == null) {
            columns[col.colName] = col;
          }
        }

        this.request.emit('columnMetadata', columns);
      } else {
        this.request.emit('columnMetadata', token.columns);
      }
    }
  }

  onOrder(token) {
    if (!this.request.canceled) {
      this.request.emit('order', token.orderColumns);
    }
  }

  onRow(token) {
    if (!this.request.canceled) {
      if (this.connection.config.options.rowCollectionOnRequestCompletion) {
        this.request.rows.push(token.columns);
      }

      if (this.connection.config.options.rowCollectionOnDone) {
        this.request.rst.push(token.columns);
      }

      this.request.emit('row', token.columns);
    }
  }

  onReturnStatus(token) {
    if (!this.request.canceled) {
      // Keep value for passing in 'doneProc' event.
      this.connection.procReturnStatusValue = token.value;
    }
  }

  onReturnValue(token) {
    if (!this.request.canceled) {
      this.request.emit('returnValue', token.paramName, token.value, token.metadata);
    }
  }

  onDoneProc(token) {
    if (!this.request.canceled) {
      if (token.sqlError && !this.request.error) {
        // check if the DONE_ERROR flags was set, but an ERROR token was not sent.
        this.request.error = (0, _errors.RequestError)('An unknown error has occurred.', 'UNKNOWN');
      }

      this.request.emit('doneProc', token.rowCount, token.more, this.connection.procReturnStatusValue, this.request.rst);
      this.connection.procReturnStatusValue = undefined;

      if (token.rowCount !== undefined) {
        this.request.rowCount += token.rowCount;
      }

      if (this.connection.config.options.rowCollectionOnDone) {
        this.request.rst = [];
      }
    }
  }

  onDoneInProc(token) {
    if (!this.request.canceled) {
      this.request.emit('doneInProc', token.rowCount, token.more, this.request.rst);

      if (token.rowCount !== undefined) {
        this.request.rowCount += token.rowCount;
      }

      if (this.connection.config.options.rowCollectionOnDone) {
        this.request.rst = [];
      }
    }
  }

  onDone(token) {
    if (!this.request.canceled) {
      if (token.sqlError && !this.request.error) {
        // check if the DONE_ERROR flags was set, but an ERROR token was not sent.
        this.request.error = (0, _errors.RequestError)('An unknown error has occurred.', 'UNKNOWN');
      }

      this.request.emit('done', token.rowCount, token.more, this.request.rst);

      if (token.rowCount !== undefined) {
        this.request.rowCount += token.rowCount;
      }

      if (this.connection.config.options.rowCollectionOnDone) {
        this.request.rst = [];
      }
    }
  }

  onResetConnection(token) {
    this.connection.emit('resetConnection');
  }

}
/**
 * A handler for the attention acknowledgement message.
 *
 * This message only contains a `DONE` token that acknowledges
 * that the attention message was received by the server.
 */


exports.RequestTokenHandler = RequestTokenHandler;

class AttentionTokenHandler extends TokenHandler {
  /**
   * Returns whether an attention acknowledgement was received.
   */
  constructor(connection, request) {
    super();
    this.connection = void 0;
    this.request = void 0;
    this.attentionReceived = void 0;
    this.connection = connection;
    this.request = request;
    this.attentionReceived = false;
  }

  onDone(token) {
    if (token.attention) {
      this.attentionReceived = true;
    }
  }

}

exports.AttentionTokenHandler = AttentionTokenHandler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90b2tlbi9oYW5kbGVyLnRzIl0sIm5hbWVzIjpbIlVuZXhwZWN0ZWRUb2tlbkVycm9yIiwiRXJyb3IiLCJjb25zdHJ1Y3RvciIsImhhbmRsZXIiLCJ0b2tlbiIsIm5hbWUiLCJUb2tlbkhhbmRsZXIiLCJvbkluZm9NZXNzYWdlIiwib25FcnJvck1lc3NhZ2UiLCJvblNTUEkiLCJvbkRhdGFiYXNlQ2hhbmdlIiwib25MYW5ndWFnZUNoYW5nZSIsIm9uQ2hhcnNldENoYW5nZSIsIm9uU3FsQ29sbGF0aW9uQ2hhbmdlIiwib25Sb3V0aW5nQ2hhbmdlIiwib25QYWNrZXRTaXplQ2hhbmdlIiwib25SZXNldENvbm5lY3Rpb24iLCJvbkJlZ2luVHJhbnNhY3Rpb24iLCJvbkNvbW1pdFRyYW5zYWN0aW9uIiwib25Sb2xsYmFja1RyYW5zYWN0aW9uIiwib25GZWRBdXRoSW5mbyIsIm9uRmVhdHVyZUV4dEFjayIsIm9uTG9naW5BY2siLCJvbkNvbE1ldGFkYXRhIiwib25PcmRlciIsIm9uUm93Iiwib25SZXR1cm5TdGF0dXMiLCJvblJldHVyblZhbHVlIiwib25Eb25lUHJvYyIsIm9uRG9uZUluUHJvYyIsIm9uRG9uZSIsIm9uRGF0YWJhc2VNaXJyb3JpbmdQYXJ0bmVyIiwiSW5pdGlhbFNxbFRva2VuSGFuZGxlciIsImNvbm5lY3Rpb24iLCJlbWl0IiwibmV3VmFsdWUiLCJkYXRhYmFzZUNvbGxhdGlvbiIsIm1lc3NhZ2VJbyIsInBhY2tldFNpemUiLCJ0cmFuc2FjdGlvbkRlc2NyaXB0b3JzIiwicHVzaCIsImluVHJhbnNhY3Rpb24iLCJsZW5ndGgiLCJjbG9zZSIsIkxvZ2luN1Rva2VuSGFuZGxlciIsImZlZEF1dGhJbmZvVG9rZW4iLCJyb3V0aW5nRGF0YSIsImxvZ2luQWNrUmVjZWl2ZWQiLCJlcnJvciIsIm1lc3NhZ2UiLCJpc0xvZ2luRXJyb3JUcmFuc2llbnQiLCJ0cmFuc2llbnRFcnJvckxvb2t1cCIsImlzVHJhbnNpZW50RXJyb3IiLCJudW1iZXIiLCJjdXJUcmFuc2llbnRSZXRyeUNvdW50IiwiY29uZmlnIiwib3B0aW9ucyIsIm1heFJldHJpZXNPblRyYW5zaWVudEVycm9ycyIsImlzVHJhbnNpZW50IiwibG9naW5FcnJvciIsIm50bG1wYWNrZXQiLCJudGxtcGFja2V0QnVmZmVyIiwiYXV0aGVudGljYXRpb24iLCJ0eXBlIiwiZmVkQXV0aCIsInVuZGVmaW5lZCIsInV0ZjhTdXBwb3J0IiwidGRzVmVyc2lvbiIsImludGVyZmFjZSIsInNlcnZlciIsInNwbGl0IiwicG9ydCIsIlJlcXVlc3RUb2tlbkhhbmRsZXIiLCJyZXF1ZXN0IiwiY2FuY2VsZWQiLCJSZXF1ZXN0RXJyb3IiLCJzdGF0ZSIsImNsYXNzIiwic2VydmVyTmFtZSIsInByb2NOYW1lIiwibGluZU51bWJlciIsInVzZUNvbHVtbk5hbWVzIiwiY29sdW1ucyIsIk9iamVjdCIsImNyZWF0ZSIsImoiLCJsZW4iLCJjb2wiLCJjb2xOYW1lIiwib3JkZXJDb2x1bW5zIiwicm93Q29sbGVjdGlvbk9uUmVxdWVzdENvbXBsZXRpb24iLCJyb3dzIiwicm93Q29sbGVjdGlvbk9uRG9uZSIsInJzdCIsInByb2NSZXR1cm5TdGF0dXNWYWx1ZSIsInZhbHVlIiwicGFyYW1OYW1lIiwibWV0YWRhdGEiLCJzcWxFcnJvciIsInJvd0NvdW50IiwibW9yZSIsIkF0dGVudGlvblRva2VuSGFuZGxlciIsImF0dGVudGlvblJlY2VpdmVkIiwiYXR0ZW50aW9uIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBRUE7O0FBaUNPLE1BQU1BLG9CQUFOLFNBQW1DQyxLQUFuQyxDQUF5QztBQUM5Q0MsRUFBQUEsV0FBVyxDQUFDQyxPQUFELEVBQXdCQyxLQUF4QixFQUFzQztBQUMvQyxVQUFNLHVCQUF1QkEsS0FBSyxDQUFDQyxJQUE3QixHQUFvQyxRQUFwQyxHQUErQ0YsT0FBTyxDQUFDRCxXQUFSLENBQW9CRyxJQUFuRSxHQUEwRSxHQUFoRjtBQUNEOztBQUg2Qzs7OztBQU16QyxNQUFNQyxZQUFOLENBQW1C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a0JBLFVBQWxCO0FBQ0EsU0FBS3dDLE9BQUwsR0FBZUEsT0FBZjtBQUVBLFNBQUs2QixpQkFBTCxHQUF5QixLQUF6QjtBQUNEOztBQUVEeEUsRUFBQUEsTUFBTSxDQUFDMUIsS0FBRCxFQUFtQjtBQUN2QixRQUFJQSxLQUFLLENBQUNtRyxTQUFWLEVBQXFCO0FBQ25CLFdBQUtELGlCQUFMLEdBQXlCLElBQXpCO0FBQ0Q7QUFDRjs7QUF0QnFEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENvbm5lY3Rpb24gZnJvbSAnLi4vY29ubmVjdGlvbic7XG5pbXBvcnQgUmVxdWVzdCBmcm9tICcuLi9yZXF1ZXN0JztcbmltcG9ydCB7IENvbm5lY3Rpb25FcnJvciwgUmVxdWVzdEVycm9yIH0gZnJvbSAnLi4vZXJyb3JzJztcbmltcG9ydCB7IENvbHVtbk1ldGFkYXRhIH0gZnJvbSAnLi9jb2xtZXRhZGF0YS10b2tlbi1wYXJzZXInO1xuaW1wb3J0IHtcbiAgQmVnaW5UcmFuc2FjdGlvbkVudkNoYW5nZVRva2VuLFxuICBDaGFyc2V0RW52Q2hhbmdlVG9rZW4sXG4gIENvbGxhdGlvbkNoYW5nZVRva2VuLFxuICBDb2xNZXRhZGF0YVRva2VuLFxuICBDb21taXRUcmFuc2FjdGlvbkVudkNoYW5nZVRva2VuLFxuICBEYXRhYmFzZUVudkNoYW5nZVRva2VuLFxuICBEYXRhYmFzZU1pcnJvcmluZ1BhcnRuZXJFbnZDaGFuZ2VUb2tlbixcbiAgRG9uZUluUHJvY1Rva2VuLFxuICBEb25lUHJvY1Rva2VuLFxuICBEb25lVG9rZW4sXG4gIEVycm9yTWVzc2FnZVRva2VuLFxuICBGZWF0dXJlRXh0QWNrVG9rZW4sXG4gIEZlZEF1dGhJbmZvVG9rZW4sXG4gIEluZm9NZXNzYWdlVG9rZW4sXG4gIExhbmd1YWdlRW52Q2hhbmdlVG9rZW4sXG4gIExvZ2luQWNrVG9rZW4sXG4gIE5CQ1Jvd1Rva2VuLFxuICBPcmRlclRva2VuLFxuICBQYWNrZXRTaXplRW52Q2hhbmdlVG9rZW4sXG4gIFJlc2V0Q29ubmVjdGlvbkVudkNoYW5nZVRva2VuLFxuICBSZXR1cm5TdGF0dXNUb2tlbixcbiAgUmV0dXJuVmFsdWVUb2tlbixcbiAgUm9sbGJhY2tUcmFuc2FjdGlvbkVudkNoYW5nZVRva2VuLFxuICBSb3V0aW5nRW52Q2hhbmdlVG9rZW4sXG4gIFJvd1Rva2VuLFxuICBTU1BJVG9rZW4sXG4gIFRva2VuXG59IGZyb20gJy4vdG9rZW4nO1xuaW1wb3J0IEJ1bGtMb2FkIGZyb20gJy4uL2J1bGstbG9hZCc7XG5cbmV4cG9ydCBjbGFzcyBVbmV4cGVjdGVkVG9rZW5FcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoaGFuZGxlcjogVG9rZW5IYW5kbGVyLCB0b2tlbjogVG9rZW4pIHtcbiAgICBzdXBlcignVW5leHBlY3RlZCB0b2tlbiBgJyArIHRva2VuLm5hbWUgKyAnYCBpbiBgJyArIGhhbmRsZXIuY29uc3RydWN0b3IubmFtZSArICdgJyk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFRva2VuSGFuZGxlciB7XG4gIG9uSW5mb01lc3NhZ2UodG9rZW46IEluZm9NZXNzYWdlVG9rZW4pIHtcbiAgICB0aHJvdyBuZXcgVW5leHBlY3RlZFRva2VuRXJyb3IodGhpcywgdG9rZW4pO1xuICB9XG5cbiAgb25FcnJvck1lc3NhZ2UodG9rZW46IEVycm9yTWVzc2FnZVRva2VuKSB7XG4gICAgdGhyb3cgbmV3IFVuZXhwZWN0ZWRUb2tlbkVycm9yKHRoaXMsIHRva2VuKTtcbiAgfVxuXG4gIG9uU1NQSSh0b2tlbjogU1NQSVRva2VuKSB7XG4gICAgdGhyb3cgbmV3IFVuZXhwZWN0ZWRUb2tlbkVycm9yKHRoaXMsIHRva2VuKTtcbiAgfVxuXG4gIG9uRGF0YWJhc2VDaGFuZ2UodG9rZW46IERhdGFiYXNlRW52Q2hhbmdlVG9rZW4pIHtcbiAgICB0aHJvdyBuZXcgVW5leHBlY3RlZFRva2VuRXJyb3IodGhpcywgdG9rZW4pO1xuICB9XG5cbiAgb25MYW5ndWFnZUNoYW5nZSh0b2tlbjogTGFuZ3VhZ2VFbnZDaGFuZ2VUb2tlbikge1xuICAgIHRocm93IG5ldyBVbmV4cGVjdGVkVG9rZW5FcnJvcih0aGlzLCB0b2tlbik7XG4gIH1cblxuICBvbkNoYXJzZXRDaGFuZ2UodG9rZW46IENoYXJzZXRFbnZDaGFuZ2VUb2tlbikge1xuICAgIHRocm93IG5ldyBVbmV4cGVjdGVkVG9rZW5FcnJvcih0aGlzLCB0b2tlbik7XG4gIH1cblxuICBvblNxbENvbGxhdGlvbkNoYW5nZSh0b2tlbjogQ29sbGF0aW9uQ2hhbmdlVG9rZW4pIHtcbiAgICB0aHJvdyBuZXcgVW5leHBlY3RlZFRva2VuRXJyb3IodGhpcywgdG9rZW4pO1xuICB9XG5cbiAgb25Sb3V0aW5nQ2hhbmdlKHRva2VuOiBSb3V0aW5nRW52Q2hhbmdlVG9rZW4pIHtcbiAgICB0aHJvdyBuZXcgVW5leHBlY3RlZFRva2VuRXJyb3IodGhpcywgdG9rZW4pO1xuICB9XG5cbiAgb25QYWNrZXRTaXplQ2hhbmdlKHRva2VuOiBQYWNrZXRTaXplRW52Q2hhbmdlVG9rZW4pIHtcbiAgICB0aHJvdyBuZXcgVW5leHBlY3RlZFRva2VuRXJyb3IodGhpcywgdG9rZW4pO1xuICB9XG5cbiAgb25SZXNldENvbm5lY3Rpb24odG9rZW46IFJlc2V0Q29ubmVjdGlvbkVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhyb3cgbmV3IFVuZXhwZWN0ZWRUb2tlbkVycm9yKHRoaXMsIHRva2VuKTtcbiAgfVxuXG4gIG9uQmVnaW5UcmFuc2FjdGlvbih0b2tlbjogQmVnaW5UcmFuc2FjdGlvbkVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhyb3cgbmV3IFVuZXhwZWN0ZWRUb2tlbkVycm9yKHRoaXMsIHRva2VuKTtcbiAgfVxuXG4gIG9uQ29tbWl0VHJhbnNhY3Rpb24odG9rZW46IENvbW1pdFRyYW5zYWN0aW9uRW52Q2hhbmdlVG9rZW4pIHtcbiAgICB0aHJvdyBuZXcgVW5leHBlY3RlZFRva2VuRXJyb3IodGhpcywgdG9rZW4pO1xuICB9XG5cbiAgb25Sb2xsYmFja1RyYW5zYWN0aW9uKHRva2VuOiBSb2xsYmFja1RyYW5zYWN0aW9uRW52Q2hhbmdlVG9rZW4pIHtcbiAgICB0aHJvdyBuZXcgVW5leHBlY3RlZFRva2VuRXJyb3IodGhpcywgdG9rZW4pO1xuICB9XG5cbiAgb25GZWRBdXRoSW5mbyh0b2tlbjogRmVkQXV0aEluZm9Ub2tlbikge1xuICAgIHRocm93IG5ldyBVbmV4cGVjdGVkVG9rZW5FcnJvcih0aGlzLCB0b2tlbik7XG4gIH1cblxuICBvbkZlYXR1cmVFeHRBY2sodG9rZW46IEZlYXR1cmVFeHRBY2tUb2tlbikge1xuICAgIHRocm93IG5ldyBVbmV4cGVjdGVkVG9rZW5FcnJvcih0aGlzLCB0b2tlbik7XG4gIH1cblxuICBvbkxvZ2luQWNrKHRva2VuOiBMb2dpbkFja1Rva2VuKSB7XG4gICAgdGhyb3cgbmV3IFVuZXhwZWN0ZWRUb2tlbkVycm9yKHRoaXMsIHRva2VuKTtcbiAgfVxuXG4gIG9uQ29sTWV0YWRhdGEodG9rZW46IENvbE1ldGFkYXRhVG9rZW4pIHtcbiAgICB0aHJvdyBuZXcgVW5leHBlY3RlZFRva2VuRXJyb3IodGhpcywgdG9rZW4pO1xuICB9XG5cbiAgb25PcmRlcih0b2tlbjogT3JkZXJUb2tlbikge1xuICAgIHRocm93IG5ldyBVbmV4cGVjdGVkVG9rZW5FcnJvcih0aGlzLCB0b2tlbik7XG4gIH1cblxuICBvblJvdyh0b2tlbjogUm93VG9rZW4gfCBOQkNSb3dUb2tlbikge1xuICAgIHRocm93IG5ldyBVbmV4cGVjdGVkVG9rZW5FcnJvcih0aGlzLCB0b2tlbik7XG4gIH1cblxuICBvblJldHVyblN0YXR1cyh0b2tlbjogUmV0dXJuU3RhdHVzVG9rZW4pIHtcbiAgICB0aHJvdyBuZXcgVW5leHBlY3RlZFRva2VuRXJyb3IodGhpcywgdG9rZW4pO1xuICB9XG5cbiAgb25SZXR1cm5WYWx1ZSh0b2tlbjogUmV0dXJuVmFsdWVUb2tlbikge1xuICAgIHRocm93IG5ldyBVbmV4cGVjdGVkVG9rZW5FcnJvcih0aGlzLCB0b2tlbik7XG4gIH1cblxuICBvbkRvbmVQcm9jKHRva2VuOiBEb25lUHJvY1Rva2VuKSB7XG4gICAgdGhyb3cgbmV3IFVuZXhwZWN0ZWRUb2tlbkVycm9yKHRoaXMsIHRva2VuKTtcbiAgfVxuXG4gIG9uRG9uZUluUHJvYyh0b2tlbjogRG9uZUluUHJvY1Rva2VuKSB7XG4gICAgdGhyb3cgbmV3IFVuZXhwZWN0ZWRUb2tlbkVycm9yKHRoaXMsIHRva2VuKTtcbiAgfVxuXG4gIG9uRG9uZSh0b2tlbjogRG9uZVRva2VuKSB7XG4gICAgdGhyb3cgbmV3IFVuZXhwZWN0ZWRUb2tlbkVycm9yKHRoaXMsIHRva2VuKTtcbiAgfVxuXG4gIG9uRGF0YWJhc2VNaXJyb3JpbmdQYXJ0bmVyKHRva2VuOiBEYXRhYmFzZU1pcnJvcmluZ1BhcnRuZXJFbnZDaGFuZ2VUb2tlbikge1xuICAgIHRocm93IG5ldyBVbmV4cGVjdGVkVG9rZW5FcnJvcih0aGlzLCB0b2tlbik7XG4gIH1cbn1cblxuLyoqXG4gKiBBIGhhbmRsZXIgZm9yIHRva2VucyByZWNlaXZlZCBpbiB0aGUgcmVzcG9uc2UgbWVzc2FnZSB0byB0aGUgaW5pdGlhbCBTUUwgQmF0Y2ggcmVxdWVzdFxuICogdGhhdCBzZXRzIHVwIGRpZmZlcmVudCBjb25uZWN0aW9uIHNldHRpbmdzLlxuICovXG5leHBvcnQgY2xhc3MgSW5pdGlhbFNxbFRva2VuSGFuZGxlciBleHRlbmRzIFRva2VuSGFuZGxlciB7XG4gIGNvbm5lY3Rpb246IENvbm5lY3Rpb247XG5cbiAgY29uc3RydWN0b3IoY29ubmVjdGlvbjogQ29ubmVjdGlvbikge1xuICAgIHN1cGVyKCk7XG5cbiAgICB0aGlzLmNvbm5lY3Rpb24gPSBjb25uZWN0aW9uO1xuICB9XG5cbiAgb25JbmZvTWVzc2FnZSh0b2tlbjogSW5mb01lc3NhZ2VUb2tlbikge1xuICAgIHRoaXMuY29ubmVjdGlvbi5lbWl0KCdpbmZvTWVzc2FnZScsIHRva2VuKTtcbiAgfVxuXG4gIG9uRXJyb3JNZXNzYWdlKHRva2VuOiBFcnJvck1lc3NhZ2VUb2tlbikge1xuICAgIHRoaXMuY29ubmVjdGlvbi5lbWl0KCdlcnJvck1lc3NhZ2UnLCB0b2tlbik7XG4gIH1cblxuICBvbkRhdGFiYXNlQ2hhbmdlKHRva2VuOiBEYXRhYmFzZUVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLmVtaXQoJ2RhdGFiYXNlQ2hhbmdlJywgdG9rZW4ubmV3VmFsdWUpO1xuICB9XG5cbiAgb25MYW5ndWFnZUNoYW5nZSh0b2tlbjogTGFuZ3VhZ2VFbnZDaGFuZ2VUb2tlbikge1xuICAgIHRoaXMuY29ubmVjdGlvbi5lbWl0KCdsYW5ndWFnZUNoYW5nZScsIHRva2VuLm5ld1ZhbHVlKTtcbiAgfVxuXG4gIG9uQ2hhcnNldENoYW5nZSh0b2tlbjogQ2hhcnNldEVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLmVtaXQoJ2NoYXJzZXRDaGFuZ2UnLCB0b2tlbi5uZXdWYWx1ZSk7XG4gIH1cblxuICBvblNxbENvbGxhdGlvbkNoYW5nZSh0b2tlbjogQ29sbGF0aW9uQ2hhbmdlVG9rZW4pIHtcbiAgICB0aGlzLmNvbm5lY3Rpb24uZGF0YWJhc2VDb2xsYXRpb24gPSB0b2tlbi5uZXdWYWx1ZTtcbiAgfVxuXG4gIG9uUGFja2V0U2l6ZUNoYW5nZSh0b2tlbjogUGFja2V0U2l6ZUVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLm1lc3NhZ2VJby5wYWNrZXRTaXplKHRva2VuLm5ld1ZhbHVlKTtcbiAgfVxuXG4gIG9uQmVnaW5UcmFuc2FjdGlvbih0b2tlbjogQmVnaW5UcmFuc2FjdGlvbkVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLnRyYW5zYWN0aW9uRGVzY3JpcHRvcnMucHVzaCh0b2tlbi5uZXdWYWx1ZSk7XG4gICAgdGhpcy5jb25uZWN0aW9uLmluVHJhbnNhY3Rpb24gPSB0cnVlO1xuICB9XG5cbiAgb25Db21taXRUcmFuc2FjdGlvbih0b2tlbjogQ29tbWl0VHJhbnNhY3Rpb25FbnZDaGFuZ2VUb2tlbikge1xuICAgIHRoaXMuY29ubmVjdGlvbi50cmFuc2FjdGlvbkRlc2NyaXB0b3JzLmxlbmd0aCA9IDE7XG4gICAgdGhpcy5jb25uZWN0aW9uLmluVHJhbnNhY3Rpb24gPSBmYWxzZTtcbiAgfVxuXG4gIG9uUm9sbGJhY2tUcmFuc2FjdGlvbih0b2tlbjogUm9sbGJhY2tUcmFuc2FjdGlvbkVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLnRyYW5zYWN0aW9uRGVzY3JpcHRvcnMubGVuZ3RoID0gMTtcbiAgICAvLyBBbiBvdXRlcm1vc3QgdHJhbnNhY3Rpb24gd2FzIHJvbGxlZCBiYWNrLiBSZXNldCB0aGUgdHJhbnNhY3Rpb24gY291bnRlclxuICAgIHRoaXMuY29ubmVjdGlvbi5pblRyYW5zYWN0aW9uID0gZmFsc2U7XG4gICAgdGhpcy5jb25uZWN0aW9uLmVtaXQoJ3JvbGxiYWNrVHJhbnNhY3Rpb24nKTtcbiAgfVxuXG4gIG9uQ29sTWV0YWRhdGEodG9rZW46IENvbE1ldGFkYXRhVG9rZW4pIHtcbiAgICB0aGlzLmNvbm5lY3Rpb24uZW1pdCgnZXJyb3InLCBuZXcgRXJyb3IoXCJSZWNlaXZlZCAnY29sdW1uTWV0YWRhdGEnIHdoZW4gbm8gc3FsUmVxdWVzdCBpcyBpbiBwcm9ncmVzc1wiKSk7XG4gICAgdGhpcy5jb25uZWN0aW9uLmNsb3NlKCk7XG4gIH1cblxuICBvbk9yZGVyKHRva2VuOiBPcmRlclRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLmVtaXQoJ2Vycm9yJywgbmV3IEVycm9yKFwiUmVjZWl2ZWQgJ29yZGVyJyB3aGVuIG5vIHNxbFJlcXVlc3QgaXMgaW4gcHJvZ3Jlc3NcIikpO1xuICAgIHRoaXMuY29ubmVjdGlvbi5jbG9zZSgpO1xuICB9XG5cbiAgb25Sb3codG9rZW46IFJvd1Rva2VuIHwgTkJDUm93VG9rZW4pIHtcbiAgICB0aGlzLmNvbm5lY3Rpb24uZW1pdCgnZXJyb3InLCBuZXcgRXJyb3IoXCJSZWNlaXZlZCAncm93JyB3aGVuIG5vIHNxbFJlcXVlc3QgaXMgaW4gcHJvZ3Jlc3NcIikpO1xuICAgIHRoaXMuY29ubmVjdGlvbi5jbG9zZSgpO1xuICB9XG5cbiAgb25SZXR1cm5TdGF0dXModG9rZW46IFJldHVyblN0YXR1c1Rva2VuKSB7XG4gICAgLy8gRG8gbm90aGluZ1xuICB9XG5cbiAgb25SZXR1cm5WYWx1ZSh0b2tlbjogUmV0dXJuVmFsdWVUb2tlbikge1xuICAgIC8vIERvIG5vdGhpbmdcbiAgfVxuXG4gIG9uRG9uZVByb2ModG9rZW46IERvbmVQcm9jVG9rZW4pIHtcbiAgICAvLyBEbyBub3RoaW5nXG4gIH1cblxuICBvbkRvbmVJblByb2ModG9rZW46IERvbmVJblByb2NUb2tlbikge1xuICAgIC8vIERvIG5vdGhpbmdcbiAgfVxuXG4gIG9uRG9uZSh0b2tlbjogRG9uZVRva2VuKSB7XG4gICAgLy8gRG8gbm90aGluZ1xuICB9XG5cbiAgb25SZXNldENvbm5lY3Rpb24odG9rZW46IFJlc2V0Q29ubmVjdGlvbkVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLmVtaXQoJ3Jlc2V0Q29ubmVjdGlvbicpO1xuICB9XG59XG5cbi8qKlxuICogQSBoYW5kbGVyIGZvciB0b2tlbnMgcmVjZWl2ZWQgaW4gdGhlIHJlc3BvbnNlIG1lc3NhZ2UgdG8gYSBMb2dpbjcgbWVzc2FnZS5cbiAqL1xuZXhwb3J0IGNsYXNzIExvZ2luN1Rva2VuSGFuZGxlciBleHRlbmRzIFRva2VuSGFuZGxlciB7XG4gIGNvbm5lY3Rpb246IENvbm5lY3Rpb247XG5cbiAgZmVkQXV0aEluZm9Ub2tlbjogRmVkQXV0aEluZm9Ub2tlbiB8IHVuZGVmaW5lZDtcbiAgcm91dGluZ0RhdGE6IHsgc2VydmVyOiBzdHJpbmcsIHBvcnQ6IG51bWJlciB9IHwgdW5kZWZpbmVkO1xuXG4gIGxvZ2luQWNrUmVjZWl2ZWQgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3Rvcihjb25uZWN0aW9uOiBDb25uZWN0aW9uKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIHRoaXMuY29ubmVjdGlvbiA9IGNvbm5lY3Rpb247XG4gIH1cblxuICBvbkluZm9NZXNzYWdlKHRva2VuOiBJbmZvTWVzc2FnZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLmVtaXQoJ2luZm9NZXNzYWdlJywgdG9rZW4pO1xuICB9XG5cbiAgb25FcnJvck1lc3NhZ2UodG9rZW46IEVycm9yTWVzc2FnZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLmVtaXQoJ2Vycm9yTWVzc2FnZScsIHRva2VuKTtcblxuICAgIGNvbnN0IGVycm9yID0gQ29ubmVjdGlvbkVycm9yKHRva2VuLm1lc3NhZ2UsICdFTE9HSU4nKTtcblxuICAgIGNvbnN0IGlzTG9naW5FcnJvclRyYW5zaWVudCA9IHRoaXMuY29ubmVjdGlvbi50cmFuc2llbnRFcnJvckxvb2t1cC5pc1RyYW5zaWVudEVycm9yKHRva2VuLm51bWJlcik7XG4gICAgaWYgKGlzTG9naW5FcnJvclRyYW5zaWVudCAmJiB0aGlzLmNvbm5lY3Rpb24uY3VyVHJhbnNpZW50UmV0cnlDb3VudCAhPT0gdGhpcy5jb25uZWN0aW9uLmNvbmZpZy5vcHRpb25zLm1heFJldHJpZXNPblRyYW5zaWVudEVycm9ycykge1xuICAgICAgZXJyb3IuaXNUcmFuc2llbnQgPSB0cnVlO1xuICAgIH1cblxuICAgIHRoaXMuY29ubmVjdGlvbi5sb2dpbkVycm9yID0gZXJyb3I7XG4gIH1cblxuICBvblNTUEkodG9rZW46IFNTUElUb2tlbikge1xuICAgIGlmICh0b2tlbi5udGxtcGFja2V0KSB7XG4gICAgICB0aGlzLmNvbm5lY3Rpb24ubnRsbXBhY2tldCA9IHRva2VuLm50bG1wYWNrZXQ7XG4gICAgICB0aGlzLmNvbm5lY3Rpb24ubnRsbXBhY2tldEJ1ZmZlciA9IHRva2VuLm50bG1wYWNrZXRCdWZmZXI7XG4gICAgfVxuXG4gICAgdGhpcy5jb25uZWN0aW9uLmVtaXQoJ3NzcGljaGFsbGVuZ2UnLCB0b2tlbik7XG4gIH1cblxuICBvbkRhdGFiYXNlQ2hhbmdlKHRva2VuOiBEYXRhYmFzZUVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLmVtaXQoJ2RhdGFiYXNlQ2hhbmdlJywgdG9rZW4ubmV3VmFsdWUpO1xuICB9XG5cbiAgb25MYW5ndWFnZUNoYW5nZSh0b2tlbjogTGFuZ3VhZ2VFbnZDaGFuZ2VUb2tlbikge1xuICAgIHRoaXMuY29ubmVjdGlvbi5lbWl0KCdsYW5ndWFnZUNoYW5nZScsIHRva2VuLm5ld1ZhbHVlKTtcbiAgfVxuXG4gIG9uQ2hhcnNldENoYW5nZSh0b2tlbjogQ2hhcnNldEVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLmVtaXQoJ2NoYXJzZXRDaGFuZ2UnLCB0b2tlbi5uZXdWYWx1ZSk7XG4gIH1cblxuICBvblNxbENvbGxhdGlvbkNoYW5nZSh0b2tlbjogQ29sbGF0aW9uQ2hhbmdlVG9rZW4pIHtcbiAgICB0aGlzLmNvbm5lY3Rpb24uZGF0YWJhc2VDb2xsYXRpb24gPSB0b2tlbi5uZXdWYWx1ZTtcbiAgfVxuXG4gIG9uRmVkQXV0aEluZm8odG9rZW46IEZlZEF1dGhJbmZvVG9rZW4pIHtcbiAgICB0aGlzLmZlZEF1dGhJbmZvVG9rZW4gPSB0b2tlbjtcbiAgfVxuXG4gIG9uRmVhdHVyZUV4dEFjayh0b2tlbjogRmVhdHVyZUV4dEFja1Rva2VuKSB7XG4gICAgY29uc3QgeyBhdXRoZW50aWNhdGlvbiB9ID0gdGhpcy5jb25uZWN0aW9uLmNvbmZpZztcblxuICAgIGlmIChhdXRoZW50aWNhdGlvbi50eXBlID09PSAnYXp1cmUtYWN0aXZlLWRpcmVjdG9yeS1wYXNzd29yZCcgfHwgYXV0aGVudGljYXRpb24udHlwZSA9PT0gJ2F6dXJlLWFjdGl2ZS1kaXJlY3RvcnktYWNjZXNzLXRva2VuJyB8fCBhdXRoZW50aWNhdGlvbi50eXBlID09PSAnYXp1cmUtYWN0aXZlLWRpcmVjdG9yeS1tc2ktdm0nIHx8IGF1dGhlbnRpY2F0aW9uLnR5cGUgPT09ICdhenVyZS1hY3RpdmUtZGlyZWN0b3J5LW1zaS1hcHAtc2VydmljZScgfHwgYXV0aGVudGljYXRpb24udHlwZSA9PT0gJ2F6dXJlLWFjdGl2ZS1kaXJlY3Rvcnktc2VydmljZS1wcmluY2lwYWwtc2VjcmV0Jykge1xuICAgICAgaWYgKHRva2VuLmZlZEF1dGggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb24ubG9naW5FcnJvciA9IENvbm5lY3Rpb25FcnJvcignRGlkIG5vdCByZWNlaXZlIEFjdGl2ZSBEaXJlY3RvcnkgYXV0aGVudGljYXRpb24gYWNrbm93bGVkZ2VtZW50Jyk7XG4gICAgICB9IGVsc2UgaWYgKHRva2VuLmZlZEF1dGgubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbi5sb2dpbkVycm9yID0gQ29ubmVjdGlvbkVycm9yKGBBY3RpdmUgRGlyZWN0b3J5IGF1dGhlbnRpY2F0aW9uIGFja25vd2xlZGdtZW50IGZvciAke2F1dGhlbnRpY2F0aW9uLnR5cGV9IGF1dGhlbnRpY2F0aW9uIG1ldGhvZCBpbmNsdWRlcyBleHRyYSBkYXRhYCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0b2tlbi5mZWRBdXRoID09PSB1bmRlZmluZWQgJiYgdG9rZW4udXRmOFN1cHBvcnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5jb25uZWN0aW9uLmxvZ2luRXJyb3IgPSBDb25uZWN0aW9uRXJyb3IoJ1JlY2VpdmVkIGFja25vd2xlZGdlbWVudCBmb3IgdW5rbm93biBmZWF0dXJlJyk7XG4gICAgfSBlbHNlIGlmICh0b2tlbi5mZWRBdXRoKSB7XG4gICAgICB0aGlzLmNvbm5lY3Rpb24ubG9naW5FcnJvciA9IENvbm5lY3Rpb25FcnJvcignRGlkIG5vdCByZXF1ZXN0IEFjdGl2ZSBEaXJlY3RvcnkgYXV0aGVudGljYXRpb24sIGJ1dCByZWNlaXZlZCB0aGUgYWNrbm93bGVkZ21lbnQnKTtcbiAgICB9XG4gIH1cblxuICBvbkxvZ2luQWNrKHRva2VuOiBMb2dpbkFja1Rva2VuKSB7XG4gICAgaWYgKCF0b2tlbi50ZHNWZXJzaW9uKSB7XG4gICAgICAvLyB1bnN1cHBvcnRlZCBURFMgdmVyc2lvblxuICAgICAgdGhpcy5jb25uZWN0aW9uLmxvZ2luRXJyb3IgPSBDb25uZWN0aW9uRXJyb3IoJ1NlcnZlciByZXNwb25kZWQgd2l0aCB1bmtub3duIFREUyB2ZXJzaW9uLicsICdFVERTJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCF0b2tlbi5pbnRlcmZhY2UpIHtcbiAgICAgIC8vIHVuc3VwcG9ydGVkIGludGVyZmFjZVxuICAgICAgdGhpcy5jb25uZWN0aW9uLmxvZ2luRXJyb3IgPSBDb25uZWN0aW9uRXJyb3IoJ1NlcnZlciByZXNwb25kZWQgd2l0aCB1bnN1cHBvcnRlZCBpbnRlcmZhY2UuJywgJ0VJTlRFUkZBQ0VOT1RTVVBQJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gdXNlIG5lZ290aWF0ZWQgdmVyc2lvblxuICAgIHRoaXMuY29ubmVjdGlvbi5jb25maWcub3B0aW9ucy50ZHNWZXJzaW9uID0gdG9rZW4udGRzVmVyc2lvbjtcblxuICAgIHRoaXMubG9naW5BY2tSZWNlaXZlZCA9IHRydWU7XG4gIH1cblxuICBvblJvdXRpbmdDaGFuZ2UodG9rZW46IFJvdXRpbmdFbnZDaGFuZ2VUb2tlbikge1xuICAgIC8vIFJlbW92ZXMgaW5zdGFuY2UgbmFtZSBhdHRhY2hlZCB0byB0aGUgcmVkaXJlY3QgdXJsLiBFLmcuLCByZWRpcmVjdC5kYi5uZXRcXGluc3RhbmNlMSAtLT4gcmVkaXJlY3QuZGIubmV0XG4gICAgY29uc3QgWyBzZXJ2ZXIgXSA9IHRva2VuLm5ld1ZhbHVlLnNlcnZlci5zcGxpdCgnXFxcXCcpO1xuXG4gICAgdGhpcy5yb3V0aW5nRGF0YSA9IHtcbiAgICAgIHNlcnZlciwgcG9ydDogdG9rZW4ubmV3VmFsdWUucG9ydFxuICAgIH07XG4gIH1cblxuICBvbkRvbmVJblByb2ModG9rZW46IERvbmVJblByb2NUb2tlbikge1xuICAgIC8vIERvIG5vdGhpbmdcbiAgfVxuXG4gIG9uRG9uZSh0b2tlbjogRG9uZVRva2VuKSB7XG4gICAgLy8gRG8gbm90aGluZ1xuICB9XG5cbiAgb25QYWNrZXRTaXplQ2hhbmdlKHRva2VuOiBQYWNrZXRTaXplRW52Q2hhbmdlVG9rZW4pIHtcbiAgICB0aGlzLmNvbm5lY3Rpb24ubWVzc2FnZUlvLnBhY2tldFNpemUodG9rZW4ubmV3VmFsdWUpO1xuICB9XG5cbiAgb25EYXRhYmFzZU1pcnJvcmluZ1BhcnRuZXIodG9rZW46IERhdGFiYXNlTWlycm9yaW5nUGFydG5lckVudkNoYW5nZVRva2VuKSB7XG4gICAgLy8gRG8gbm90aGluZ1xuICB9XG59XG5cbi8qKlxuICogQSBoYW5kbGVyIGZvciB0b2tlbnMgcmVjZWl2ZWQgaW4gdGhlIHJlc3BvbnNlIG1lc3NhZ2UgdG8gYSBSUEMgUmVxdWVzdCxcbiAqIGEgU1FMIEJhdGNoIFJlcXVlc3QsIGEgQnVsayBMb2FkIEJDUCBSZXF1ZXN0IG9yIGEgVHJhbnNhY3Rpb24gTWFuYWdlciBSZXF1ZXN0LlxuICovXG5leHBvcnQgY2xhc3MgUmVxdWVzdFRva2VuSGFuZGxlciBleHRlbmRzIFRva2VuSGFuZGxlciB7XG4gIGNvbm5lY3Rpb246IENvbm5lY3Rpb247XG4gIHJlcXVlc3Q6IFJlcXVlc3QgfCBCdWxrTG9hZDtcblxuICBjb25zdHJ1Y3Rvcihjb25uZWN0aW9uOiBDb25uZWN0aW9uLCByZXF1ZXN0OiBSZXF1ZXN0IHwgQnVsa0xvYWQpIHtcbiAgICBzdXBlcigpO1xuXG4gICAgdGhpcy5jb25uZWN0aW9uID0gY29ubmVjdGlvbjtcbiAgICB0aGlzLnJlcXVlc3QgPSByZXF1ZXN0O1xuICB9XG5cbiAgb25JbmZvTWVzc2FnZSh0b2tlbjogSW5mb01lc3NhZ2VUb2tlbikge1xuICAgIHRoaXMuY29ubmVjdGlvbi5lbWl0KCdpbmZvTWVzc2FnZScsIHRva2VuKTtcbiAgfVxuXG4gIG9uRXJyb3JNZXNzYWdlKHRva2VuOiBFcnJvck1lc3NhZ2VUb2tlbikge1xuICAgIHRoaXMuY29ubmVjdGlvbi5lbWl0KCdlcnJvck1lc3NhZ2UnLCB0b2tlbik7XG5cbiAgICBpZiAoIXRoaXMucmVxdWVzdC5jYW5jZWxlZCkge1xuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgUmVxdWVzdEVycm9yKHRva2VuLm1lc3NhZ2UsICdFUkVRVUVTVCcpO1xuXG4gICAgICBlcnJvci5udW1iZXIgPSB0b2tlbi5udW1iZXI7XG4gICAgICBlcnJvci5zdGF0ZSA9IHRva2VuLnN0YXRlO1xuICAgICAgZXJyb3IuY2xhc3MgPSB0b2tlbi5jbGFzcztcbiAgICAgIGVycm9yLnNlcnZlck5hbWUgPSB0b2tlbi5zZXJ2ZXJOYW1lO1xuICAgICAgZXJyb3IucHJvY05hbWUgPSB0b2tlbi5wcm9jTmFtZTtcbiAgICAgIGVycm9yLmxpbmVOdW1iZXIgPSB0b2tlbi5saW5lTnVtYmVyO1xuXG4gICAgICB0aGlzLnJlcXVlc3QuZXJyb3IgPSBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBvbkRhdGFiYXNlQ2hhbmdlKHRva2VuOiBEYXRhYmFzZUVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLmVtaXQoJ2RhdGFiYXNlQ2hhbmdlJywgdG9rZW4ubmV3VmFsdWUpO1xuICB9XG5cbiAgb25MYW5ndWFnZUNoYW5nZSh0b2tlbjogTGFuZ3VhZ2VFbnZDaGFuZ2VUb2tlbikge1xuICAgIHRoaXMuY29ubmVjdGlvbi5lbWl0KCdsYW5ndWFnZUNoYW5nZScsIHRva2VuLm5ld1ZhbHVlKTtcbiAgfVxuXG4gIG9uQ2hhcnNldENoYW5nZSh0b2tlbjogQ2hhcnNldEVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLmVtaXQoJ2NoYXJzZXRDaGFuZ2UnLCB0b2tlbi5uZXdWYWx1ZSk7XG4gIH1cblxuICBvblNxbENvbGxhdGlvbkNoYW5nZSh0b2tlbjogQ29sbGF0aW9uQ2hhbmdlVG9rZW4pIHtcbiAgICB0aGlzLmNvbm5lY3Rpb24uZGF0YWJhc2VDb2xsYXRpb24gPSB0b2tlbi5uZXdWYWx1ZTtcbiAgfVxuXG4gIG9uUGFja2V0U2l6ZUNoYW5nZSh0b2tlbjogUGFja2V0U2l6ZUVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLm1lc3NhZ2VJby5wYWNrZXRTaXplKHRva2VuLm5ld1ZhbHVlKTtcbiAgfVxuXG4gIG9uQmVnaW5UcmFuc2FjdGlvbih0b2tlbjogQmVnaW5UcmFuc2FjdGlvbkVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLnRyYW5zYWN0aW9uRGVzY3JpcHRvcnMucHVzaCh0b2tlbi5uZXdWYWx1ZSk7XG4gICAgdGhpcy5jb25uZWN0aW9uLmluVHJhbnNhY3Rpb24gPSB0cnVlO1xuICB9XG5cbiAgb25Db21taXRUcmFuc2FjdGlvbih0b2tlbjogQ29tbWl0VHJhbnNhY3Rpb25FbnZDaGFuZ2VUb2tlbikge1xuICAgIHRoaXMuY29ubmVjdGlvbi50cmFuc2FjdGlvbkRlc2NyaXB0b3JzLmxlbmd0aCA9IDE7XG4gICAgdGhpcy5jb25uZWN0aW9uLmluVHJhbnNhY3Rpb24gPSBmYWxzZTtcbiAgfVxuXG4gIG9uUm9sbGJhY2tUcmFuc2FjdGlvbih0b2tlbjogUm9sbGJhY2tUcmFuc2FjdGlvbkVudkNoYW5nZVRva2VuKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLnRyYW5zYWN0aW9uRGVzY3JpcHRvcnMubGVuZ3RoID0gMTtcbiAgICAvLyBBbiBvdXRlcm1vc3QgdHJhbnNhY3Rpb24gd2FzIHJvbGxlZCBiYWNrLiBSZXNldCB0aGUgdHJhbnNhY3Rpb24gY291bnRlclxuICAgIHRoaXMuY29ubmVjdGlvbi5pblRyYW5zYWN0aW9uID0gZmFsc2U7XG4gICAgdGhpcy5jb25uZWN0aW9uLmVtaXQoJ3JvbGxiYWNrVHJhbnNhY3Rpb24nKTtcbiAgfVxuXG4gIG9uQ29sTWV0YWRhdGEodG9rZW46IENvbE1ldGFkYXRhVG9rZW4pIHtcbiAgICBpZiAoIXRoaXMucmVxdWVzdC5jYW5jZWxlZCkge1xuICAgICAgaWYgKHRoaXMuY29ubmVjdGlvbi5jb25maWcub3B0aW9ucy51c2VDb2x1bW5OYW1lcykge1xuICAgICAgICBjb25zdCBjb2x1bW5zOiB7IFtrZXk6IHN0cmluZ106IENvbHVtbk1ldGFkYXRhIH0gPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4gICAgICAgIGZvciAobGV0IGogPSAwLCBsZW4gPSB0b2tlbi5jb2x1bW5zLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgICAgY29uc3QgY29sID0gdG9rZW4uY29sdW1uc1tqXTtcbiAgICAgICAgICBpZiAoY29sdW1uc1tjb2wuY29sTmFtZV0gPT0gbnVsbCkge1xuICAgICAgICAgICAgY29sdW1uc1tjb2wuY29sTmFtZV0gPSBjb2w7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZXF1ZXN0LmVtaXQoJ2NvbHVtbk1ldGFkYXRhJywgY29sdW1ucyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnJlcXVlc3QuZW1pdCgnY29sdW1uTWV0YWRhdGEnLCB0b2tlbi5jb2x1bW5zKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvbk9yZGVyKHRva2VuOiBPcmRlclRva2VuKSB7XG4gICAgaWYgKCF0aGlzLnJlcXVlc3QuY2FuY2VsZWQpIHtcbiAgICAgIHRoaXMucmVxdWVzdC5lbWl0KCdvcmRlcicsIHRva2VuLm9yZGVyQ29sdW1ucyk7XG4gICAgfVxuICB9XG5cbiAgb25Sb3codG9rZW46IFJvd1Rva2VuIHwgTkJDUm93VG9rZW4pIHtcbiAgICBpZiAoIXRoaXMucmVxdWVzdC5jYW5jZWxlZCkge1xuICAgICAgaWYgKHRoaXMuY29ubmVjdGlvbi5jb25maWcub3B0aW9ucy5yb3dDb2xsZWN0aW9uT25SZXF1ZXN0Q29tcGxldGlvbikge1xuICAgICAgICB0aGlzLnJlcXVlc3Qucm93cyEucHVzaCh0b2tlbi5jb2x1bW5zKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuY29ubmVjdGlvbi5jb25maWcub3B0aW9ucy5yb3dDb2xsZWN0aW9uT25Eb25lKSB7XG4gICAgICAgIHRoaXMucmVxdWVzdC5yc3QhLnB1c2godG9rZW4uY29sdW1ucyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMucmVxdWVzdC5lbWl0KCdyb3cnLCB0b2tlbi5jb2x1bW5zKTtcbiAgICB9XG4gIH1cblxuICBvblJldHVyblN0YXR1cyh0b2tlbjogUmV0dXJuU3RhdHVzVG9rZW4pIHtcbiAgICBpZiAoIXRoaXMucmVxdWVzdC5jYW5jZWxlZCkge1xuICAgICAgLy8gS2VlcCB2YWx1ZSBmb3IgcGFzc2luZyBpbiAnZG9uZVByb2MnIGV2ZW50LlxuICAgICAgdGhpcy5jb25uZWN0aW9uLnByb2NSZXR1cm5TdGF0dXNWYWx1ZSA9IHRva2VuLnZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIG9uUmV0dXJuVmFsdWUodG9rZW46IFJldHVyblZhbHVlVG9rZW4pIHtcbiAgICBpZiAoIXRoaXMucmVxdWVzdC5jYW5jZWxlZCkge1xuICAgICAgdGhpcy5yZXF1ZXN0LmVtaXQoJ3JldHVyblZhbHVlJywgdG9rZW4ucGFyYW1OYW1lLCB0b2tlbi52YWx1ZSwgdG9rZW4ubWV0YWRhdGEpO1xuICAgIH1cbiAgfVxuXG4gIG9uRG9uZVByb2ModG9rZW46IERvbmVQcm9jVG9rZW4pIHtcbiAgICBpZiAoIXRoaXMucmVxdWVzdC5jYW5jZWxlZCkge1xuICAgICAgaWYgKHRva2VuLnNxbEVycm9yICYmICF0aGlzLnJlcXVlc3QuZXJyb3IpIHtcbiAgICAgICAgLy8gY2hlY2sgaWYgdGhlIERPTkVfRVJST1IgZmxhZ3Mgd2FzIHNldCwgYnV0IGFuIEVSUk9SIHRva2VuIHdhcyBub3Qgc2VudC5cbiAgICAgICAgdGhpcy5yZXF1ZXN0LmVycm9yID0gUmVxdWVzdEVycm9yKCdBbiB1bmtub3duIGVycm9yIGhhcyBvY2N1cnJlZC4nLCAnVU5LTk9XTicpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnJlcXVlc3QuZW1pdCgnZG9uZVByb2MnLCB0b2tlbi5yb3dDb3VudCwgdG9rZW4ubW9yZSwgdGhpcy5jb25uZWN0aW9uLnByb2NSZXR1cm5TdGF0dXNWYWx1ZSwgdGhpcy5yZXF1ZXN0LnJzdCk7XG5cbiAgICAgIHRoaXMuY29ubmVjdGlvbi5wcm9jUmV0dXJuU3RhdHVzVmFsdWUgPSB1bmRlZmluZWQ7XG5cbiAgICAgIGlmICh0b2tlbi5yb3dDb3VudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMucmVxdWVzdC5yb3dDb3VudCEgKz0gdG9rZW4ucm93Q291bnQ7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb24uY29uZmlnLm9wdGlvbnMucm93Q29sbGVjdGlvbk9uRG9uZSkge1xuICAgICAgICB0aGlzLnJlcXVlc3QucnN0ID0gW107XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgb25Eb25lSW5Qcm9jKHRva2VuOiBEb25lSW5Qcm9jVG9rZW4pIHtcbiAgICBpZiAoIXRoaXMucmVxdWVzdC5jYW5jZWxlZCkge1xuICAgICAgdGhpcy5yZXF1ZXN0LmVtaXQoJ2RvbmVJblByb2MnLCB0b2tlbi5yb3dDb3VudCwgdG9rZW4ubW9yZSwgdGhpcy5yZXF1ZXN0LnJzdCk7XG5cbiAgICAgIGlmICh0b2tlbi5yb3dDb3VudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMucmVxdWVzdC5yb3dDb3VudCEgKz0gdG9rZW4ucm93Q291bnQ7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb24uY29uZmlnLm9wdGlvbnMucm93Q29sbGVjdGlvbk9uRG9uZSkge1xuICAgICAgICB0aGlzLnJlcXVlc3QucnN0ID0gW107XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgb25Eb25lKHRva2VuOiBEb25lVG9rZW4pIHtcbiAgICBpZiAoIXRoaXMucmVxdWVzdC5jYW5jZWxlZCkge1xuICAgICAgaWYgKHRva2VuLnNxbEVycm9yICYmICF0aGlzLnJlcXVlc3QuZXJyb3IpIHtcbiAgICAgICAgLy8gY2hlY2sgaWYgdGhlIERPTkVfRVJST1IgZmxhZ3Mgd2FzIHNldCwgYnV0IGFuIEVSUk9SIHRva2VuIHdhcyBub3Qgc2VudC5cbiAgICAgICAgdGhpcy5yZXF1ZXN0LmVycm9yID0gUmVxdWVzdEVycm9yKCdBbiB1bmtub3duIGVycm9yIGhhcyBvY2N1cnJlZC4nLCAnVU5LTk9XTicpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnJlcXVlc3QuZW1pdCgnZG9uZScsIHRva2VuLnJvd0NvdW50LCB0b2tlbi5tb3JlLCB0aGlzLnJlcXVlc3QucnN0KTtcblxuICAgICAgaWYgKHRva2VuLnJvd0NvdW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5yZXF1ZXN0LnJvd0NvdW50ISArPSB0b2tlbi5yb3dDb3VudDtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuY29ubmVjdGlvbi5jb25maWcub3B0aW9ucy5yb3dDb2xsZWN0aW9uT25Eb25lKSB7XG4gICAgICAgIHRoaXMucmVxdWVzdC5yc3QgPSBbXTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvblJlc2V0Q29ubmVjdGlvbih0b2tlbjogUmVzZXRDb25uZWN0aW9uRW52Q2hhbmdlVG9rZW4pIHtcbiAgICB0aGlzLmNvbm5lY3Rpb24uZW1pdCgncmVzZXRDb25uZWN0aW9uJyk7XG4gIH1cbn1cblxuLyoqXG4gKiBBIGhhbmRsZXIgZm9yIHRoZSBhdHRlbnRpb24gYWNrbm93bGVkZ2VtZW50IG1lc3NhZ2UuXG4gKlxuICogVGhpcyBtZXNzYWdlIG9ubHkgY29udGFpbnMgYSBgRE9ORWAgdG9rZW4gdGhhdCBhY2tub3dsZWRnZXNcbiAqIHRoYXQgdGhlIGF0dGVudGlvbiBtZXNzYWdlIHdhcyByZWNlaXZlZCBieSB0aGUgc2VydmVyLlxuICovXG5leHBvcnQgY2xhc3MgQXR0ZW50aW9uVG9rZW5IYW5kbGVyIGV4dGVuZHMgVG9rZW5IYW5kbGVyIHtcbiAgY29ubmVjdGlvbjogQ29ubmVjdGlvbjtcbiAgcmVxdWVzdDogUmVxdWVzdCB8IEJ1bGtMb2FkO1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHdoZXRoZXIgYW4gYXR0ZW50aW9uIGFja25vd2xlZGdlbWVudCB3YXMgcmVjZWl2ZWQuXG4gICAqL1xuICBhdHRlbnRpb25SZWNlaXZlZDogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3Rvcihjb25uZWN0aW9uOiBDb25uZWN0aW9uLCByZXF1ZXN0OiBSZXF1ZXN0IHwgQnVsa0xvYWQpIHtcbiAgICBzdXBlcigpO1xuXG4gICAgdGhpcy5jb25uZWN0aW9uID0gY29ubmVjdGlvbjtcbiAgICB0aGlzLnJlcXVlc3QgPSByZXF1ZXN0O1xuXG4gICAgdGhpcy5hdHRlbnRpb25SZWNlaXZlZCA9IGZhbHNlO1xuICB9XG5cbiAgb25Eb25lKHRva2VuOiBEb25lVG9rZW4pIHtcbiAgICBpZiAodG9rZW4uYXR0ZW50aW9uKSB7XG4gICAgICB0aGlzLmF0dGVudGlvblJlY2VpdmVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==